var app=angular.module("MorseWeb",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(a,c){c.otherwise("/");a.state("home",{url:"/",templateUrl:"templates/join.html",controller:"LoginCtrl"}).state("chat",{url:"/chat",templateUrl:"templates/chat.html",controller:"ChatCtrl"})}]);app.service("Socket",[function(){return{io:io("https://elb.morseapp.com")}}]);app.filter("reverse",[function(){return function(a){return a.slice().reverse()}}]);
app.filter("isImage",["$sce",function(a){return function(c){var d=c.replace(/</g,"&lt;").replace(/>/g,"&gt;").match(/[^/]+(jpg|png|gif)$/),f=c.replace(/</g,"&lt;").replace(/>/g,"&gt;").match(/base64/g);return d?a.trustAsHtml('<img width="50%" src="'+c+'">'):f?a.trustAsHtml('<img width="50%" src="'+c+'">'):a.trustAsHtml(c.replace(/</g,"&lt;").replace(/>/g,"&gt;"))}}]);
app.controller("LoginCtrl",["$scope","$rootScope","$state",function(a,c,d){a.join=function(){c.username=this.username;c.room=this.code;d.go("chat")}}]);
app.controller("ChatCtrl",["$scope","Socket","$rootScope","$state","$stateParams",function(a,c,d,f,g){a.exit=function(){e.emit("disconnectuser",{});f.go("home")};if(d.username&&d.room){a.currentuser=d.username;var e=c.io;e.emit("join",{username:d.username,room:d.room});$("form").submit(function(a){a.preventDefault();$("#m").val()&&(e.emit("chat",$("#m").val()),$("#m").val(""))});a.messages=[];e.on("chat",function(b){a.messages.push(b);a.$apply()});e.on("users",function(b){a.users=b;a.$apply()});e.on("update",
function(b){"welcome"===b.type?a.messages.push({msg:"Welcome!",type:"update"}):"user-join"===b.type?a.messages.push({msg:b.user+" has joined the room.",type:"update"}):"invalid-code"===b.type?a.exit():"share-code"===b.type?a.messages.push({msg:"Share code: "+b.code,type:"update",code:b.code,info:"Tap to copy"}):"user-disconnected"===b.type&&a.messages.push({msg:b.user+" has left the room.",type:"update"});a.$apply()});e.on("disconnect",function(){f.go("home")});e.on("invalid",function(){f.go("home")});
e.on("connect_failed",function(){f.go("home")})}else f.go("home")}]);
